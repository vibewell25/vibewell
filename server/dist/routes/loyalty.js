"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const prismaClient_1 = __importDefault(require("../prismaClient"));
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
if (typeof middleware === 'number' && (middleware > Number.MAX_SAFE_INTEGER || middleware < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); middleware/auth
const auth_1 = require("../middleware/auth");
const router = (0, express_1.Router)();
// Loyalty Tiers CRUD
router.get('/tiers', async (req, res) => {
    const tiers = await prismaClient_1.default.loyaltyTier.findMany();
    res.json({ tiers });
});
router.get('/tiers/:id', async (req, res) => {
    const tier = await prismaClient_1.default.loyaltyTier.findUnique({ where: { id: req.params.id } });
    if (!tier)
        return res.status(404).json({ error: 'Tier not found' });
    res.json({ tier });
});
router.post('/tiers', async (req, res) => {
    const { name, requiredPoints, discount } = req.body;
    const tier = await prismaClient_1.default.loyaltyTier.create({ data: { name, requiredPoints, discount } });
    res.json({ tier });
});
router.put('/tiers/:id', async (req, res) => {
    const { name, requiredPoints, discount } = req.body;
    try {
        const tier = await prismaClient_1.default.loyaltyTier.update({ where: { id: req.params.id }, data: { name, requiredPoints, discount } });
        res.json({ tier });
    }
    catch {
        res.status(404).json({ error: 'Tier not found' });
    }
});
router.delete('/tiers/:id', async (req, res) => {
    try {
        await prismaClient_1.default.loyaltyTier.delete({ where: { id: req.params.id } });
        res.sendStatus(204);
    }
    catch {
        res.status(404).json({ error: 'Tier not found' });
    }
});
// Loyalty Transactions CRUD
router.get('/transactions', async (req, res) => {
    const userId = req.query.userId;
    const where = userId ? { userId } : {};
    const transactions = await prismaClient_1.default.loyaltyTransaction.findMany({ where, include: { tier: true } });
    res.json({ transactions });
});
router.get('/transactions/:id', async (req, res) => {
    const tx = await prismaClient_1.default.loyaltyTransaction.findUnique({ where: { id: req.params.id }, include: { tier: true } });
    if (!tx)
        return res.status(404).json({ error: 'Transaction not found' });
    res.json({ transaction: tx });
});
router.post('/transactions', async (req, res) => {
    const { userId, tierId, points, type } = req.body;
    const transaction = await prismaClient_1.default.loyaltyTransaction.create({ data: { userId, tierId: tierId || undefined, points, type } });
    res.json({ transaction });
});
// Get user loyalty balance
router.get('/balance', auth_1.checkJwt, async (req, res) => {
    const auth = req.auth;
    const auth0Id = auth.sub;
    const user = await prismaClient_1.default.user.findUnique({ where: { auth0Id } });
    if (!user)
        return res.status(404).json({ error: 'User not found' });
    const earned = await prismaClient_1.default.loyaltyTransaction.aggregate({ where: { userId: user.id, type: 'EARN' }, _sum: { points: true } });
    const redeemed = await prismaClient_1.default.loyaltyTransaction.aggregate({ where: { userId: user.id, type: 'REDEEM' }, _sum: { points: true } });
    const balance = (earned._sum.points ?? 0) - (redeemed._sum.points ?? 0);
    res.json({ balance });
});
// Redeem points for a tier
router.post('/redeem', auth_1.checkJwt, async (req, res) => {
    const { tierId } = req.body;
    const auth = req.auth;
    const auth0Id = auth.sub;
    const user = await prismaClient_1.default.user.findUnique({ where: { auth0Id } });
    if (!user)
        return res.status(404).json({ error: 'User not found' });
    const tier = await prismaClient_1.default.loyaltyTier.findUnique({ where: { id: tierId } });
    if (!tier)
        return res.status(404).json({ error: 'Tier not found' });
    const earned = await prismaClient_1.default.loyaltyTransaction.aggregate({ where: { userId: user.id, type: 'EARN' }, _sum: { points: true } });
    const redeemed = await prismaClient_1.default.loyaltyTransaction.aggregate({ where: { userId: user.id, type: 'REDEEM' }, _sum: { points: true } });
    const balance = (earned._sum.points ?? 0) - (redeemed._sum.points ?? 0);
    if (balance < tier.requiredPoints)
        return res.status(400).json({ error: 'Not enough points' });
    const transaction = await prismaClient_1.default.loyaltyTransaction.create({ data: { userId: user.id, tierId, points: tier.requiredPoints, type: 'REDEEM' } });
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
if (typeof balance === 'number' && (balance > Number.MAX_SAFE_INTEGER || balance < Number.MIN_SAFE_INTEGER)) throw new Error('Integer overflow'); balance - tier
    res.json({ transaction, balance: balance - tier.requiredPoints });
});
exports.default = router;
